{
  "$schema": "http://json-schema.org/draft-04/schema#",
  "title": "Heft Configuration",
  "description": "Defines configuration used by core Heft.",
  "type": "object",

  "definitions": {
    "anything": {
      "type": ["array", "boolean", "integer", "number", "object", "string"],
      "items": { "$ref": "#/definitions/anything" }
    },

    "heft-plugin": {
      "description": "A plugin that can be used to extend Heft functionality.",
      "type": "object",
      "required": ["pluginPackage"],
      "additionalProperties": false,
      "properties": {
        "pluginPackage": {
          "description": "The plugin package name.",
          "type": "string",
          "pattern": "[^\\\\]"
        },
        "pluginName": {
          "description": "Name of the plugin to load from the specified package. If not specified and the plugin package provides a single plugin, that plugin will be loaded.",
          "type": "string"
        },
        "options": {
          "description": "Options to pass to the plugin.",
          "type": "object"
        }
      }
    },

    "heft-event": {
      "description": "An event that can be used to extend Heft functionality.",
      "type": "object",
      "required": ["eventKind"],
      "additionalProperties": false,
      "properties": {
        "eventKind": {
          "description": "Name of the event to trigger.",
          "type": "string",
          "enum": ["copyFiles", "deleteGlobs", "runScript"]
        },
        "options": {
          "description": "Options to pass to the event.",
          "type": "object"
        }
      }
    }
  },

  "additionalProperties": false,

  "properties": {
    "$schema": {
      "description": "Part of the JSON Schema standard, this optional keyword declares the URL of the schema that the file conforms to. Editors may download the schema and use it to perform syntax highlighting.",
      "type": "string"
    },

    "extends": {
      "description": "Optionally specifies another JSON config file that this file extends from.  This provides a way for standard settings to be shared across multiple projects.",
      "type": "string"
    },

    "heftPlugins": {
      "type": "array",
      "description": "List of Heft plugins that are used by a project.",
      "items": { "$ref": "#/definitions/heft-plugin" }
    },

    "phasesByName": {
      "type": "object",
      "description": "Heft phases that can be run during an execution of Heft.",
      "additionalProperties": false,
      "patternProperties": {
        "^[a-zA-Z0-9-_]+$": {
          "description": "Defines a Heft phase.",
          "type": "object",
          "additionalProperties": false,
          "properties": {
            "phaseDescription": {
              "description": "A description of the purpose of the Heft phase.",
              "type": "string"
            },

            "phaseDependencies": {
              "type": "array",
              "description": "List of phase names that must be run before this phase.",
              "items": {
                "type": "string",
                "pattern": "[a-zA-Z0-9-_]+"
              }
            },

            "tasksByName": {
              "description": "Heft tasks that are run during an execution of the Heft phase.",
              "type": "object",
              "additionalProperties": false,
              "patternProperties": {
                "^[a-zA-Z0-9-_]+$": {
                  "type": "object",
                  "description": "Defines a Heft task.",
                  "additionalProperties": false,
                  "oneOf": [
                    {
                      "required": ["taskPlugin"],
                      "properties": {
                        "taskPlugin": { "$ref": "#/definitions/heft-plugin" }
                      }
                    },
                    {
                      "required": ["taskEvent"],
                      "properties": {
                        "taskEvent": { "$ref": "#/definitions/heft-event" }
                      }
                    }
                  ],
                  "properties": {
                    "taskPlugin": {
                      "description": "A plugin that can be used to extend Heft functionality.",
                      "type": "object"
                    },
                    "taskEvent": {
                      "description": "An event that can be used to extend Heft functionality.",
                      "type": "object"
                    },

                    "taskDependencies": {
                      "type": "array",
                      "description": "List of task names that must be run before this task.",
                      "items": {
                        "type": "string",
                        "pattern": "[a-zA-Z0-9-_]+"
                      }
                    }
                  }
                }
              }
            }
          }
        }
      }
    }
  }
}
